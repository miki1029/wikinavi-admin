<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 위 3개의 메타 태그는 *반드시* head 태그의 처음에 와야합니다; 어떤 다른 콘텐츠들은 반드시 이 태그들 *다음에* 와야 합니다 -->
    <title>Wikinavi</title>

    <!-- 부트스트랩 -->
    <link href="../static/css/bootstrap/bootstrap.min.css" th:href="@{css/bootstrap/bootstrap.min.css}"
          rel="stylesheet">

    <!-- IE8 에서 HTML5 요소와 미디어 쿼리를 위한 HTML5 shim 와 Respond.js -->
    <!-- WARNING: Respond.js 는 당신이 file:// 을 통해 페이지를 볼 때는 동작하지 않습니다. -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>

<!-- Image Info -->
<h3>이미지 정보
    <small>너비 100 기준 상대 크기</small>
</h3>
<table id="imageInfo" class="table">
    <tr>
        <th>(너비, 높이)</th>
        <td>(<span id="imageWidthInfo"></span>,<span id="imageHeightInfo"></span>)</td>
    </tr>
    <tr>
        <th>(X,Y)</th>
        <td>(<span id="imageXPos"></span>,<span id="imageYPos"></span>)</td>
    </tr>
</table>

<!-- images -->
<div class="row">
    <div class="col-xs-12">
        <div id="originalImageArea" class="thumbnail">
            <img src="../static/images/20150904_170026.jpg" th:src="@{images/20150904_170026.jpg}"
                 id="mapImage" alt="Map Image" onclick="getImageClickPosition(this)"/>
        </div>
        <div id="dashedImageArea" class="thumbnail"></div>
    </div>
</div>

</div>
<!-- col -->


<!-- jQuery (부트스트랩의 자바스크립트 플러그인을 위해 필요합니다) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<!-- 모든 컴파일된 플러그인을 포함합니다 (아래), 원하지 않는다면 필요한 각각의 파일을 포함하세요 -->
<script src="../static/js/bootstrap/bootstrap.min.js" th:src="@{js/bootstrap.min.js}"></script>
<script>
    var $mapImage = $('#mapImage');
    var ratio = $mapImage.height() / $mapImage.width();
    var imageWidthRatio = 100;
    var imageHeightRatio = parseInt(imageWidthRatio * ratio);
    $('#imageWidthInfo').text(imageWidthRatio);
    $('#imageHeightInfo').text(imageHeightRatio);

    $mapImage.hover(function () {
        var width = parseInt(event.offsetX / $mapImage.width * imageWidthRatio);
        var height = parseInt(event.offsetY / $mapImage.height * imageHeightRatio);
        $('#imageXPos').text(width);
        $('#imageYPos').text(height);
    });

    function getImageClickPosition(mapImage) {
        var ratio = mapImage.height / mapImage.width;
        var imageWidthRatio = 100;
        var imageHeightRatio = parseInt(imageWidthRatio * ratio);
        var width = parseInt(event.offsetX / mapImage.width * imageWidthRatio);
        var height = parseInt(event.offsetY / mapImage.height * imageHeightRatio);
        alert(width + "," + height + "\n" + imageWidthRatio + "," + imageHeightRatio);
//            alert(event.offsetX + "," + event.offsetY + "\n" + mapImage.width + "," + mapImage.height);
    }

    var seperate = function ($img, seperateXNum) {
        var $absoluteDiv,
                $hiddenDiv = $('<div class="hiddenDiv"></div>'),
                imgWidth = $img.width(),
                imgHeight = $img.height(),
                imgSrc = $img.attr('src'),
                seperateYNum = parseInt(seperateXNum * ratio);

        $hiddenDiv.appendTo($('#dashedImageArea'));
        $('#originalImageArea').css({
            display: 'none'
        });

        var i, j;
        for (j = 0; j < seperateYNum; j++) {
            $tileRow = $('<div class="seperatedRowDiv"></div>');
            $rowDiv.appendTo($hiddenDiv);
            for (i = 0; i < seperateXNum; i++) {
                $absoluteDiv = $('<div class="seperatedDiv" style="position: absolute;"></div>');
                $absoluteDiv.css({
                    width: imgWidth / seperateXNum,
                    height: imgHeight / seperateYNum,
//                    padding: '2px',
                    left: ( imgWidth / seperateXNum ) * i,
                    top: (imgHeight / seperateYNum) * j,
                    backgroundImage: 'url( ' + imgSrc + ' )',
                    backgroundPosition: ( -( imgWidth / seperateXNum ) * i ) + 'px ' + ( -(imgHeight / seperateYNum) * j) + 'px',
                    backgroundSize: seperateXNum * 100 + '%'//,
//                    border: '1px dashed white'
                });
                $absoluteDiv.appendTo($rowDiv);
            }
        }
    };

    seperate($mapImage, 12);
</script>
</body>
</html>
